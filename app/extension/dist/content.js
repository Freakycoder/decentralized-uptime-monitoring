import{a as m}from"./chunks/index.xsH4HHeE.js";const u=10*60*1e3,n=8;let e,a=0;e=window.location.href;chrome.runtime.onMessage.addListener((o,t,r)=>{if(t.origin!=="http://localhost:3000"){console.warn("Message received from unknown origin:",t.origin);return}o.action==="START_MONITORING"&&o.url===window.location.href&&(console.log("started monitoring for:",o.url),f(o.url))});function f(o){a=0,chrome.storage.local.set({[o]:{status:"Active",startedAt:Date.now()}}),console.log(`Starting timed monitoring for ${o} - ${n} runs over ${n*u/6e4} minutes`);for(let t=0;t<n;t++)setTimeout(()=>{a=t+1,console.log(`Running ping ${a} of ${n} for ${o}`),p()},t*u);setTimeout(()=>{chrome.storage.local.set({[o]:{status:"Completed",startedAt:Date.now()}}),console.log("Monitoring completed for:",o)},n*u+5e3)}async function p(){const o=performance.now();let t;try{performance.clearResourceTimings();const r=await m.get(e,{timeout:3e4,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});await new Promise(i=>setTimeout(i,1e3));const c=performance.getEntriesByType("resource"),l=performance.getEntriesByType("navigation")[0];let s=null;s=c.find(i=>i.name===e)||null,!s&&l&&(s=l),s?t=g(s,r.status):t={dnsLookup:0,tcpConnection:0,tlsHandshake:0,ttfb:0,contentDownload:0,totalDuration:performance.now()-o,statusCode:r.status};const d={pingData:{[e]:t}};chrome.runtime.sendMessage({action:"PERF_DATA",url:e,data:d,timestamp:Date.now(),runNumber:a,totalRuns:n}),console.log(`Performance data sent for run ${a}:`,t)}catch(r){console.error(`Failed to collect performance data for run ${a}:`,r);const c={pingData:{[e]:{dnsLookup:0,tcpConnection:0,tlsHandshake:0,ttfb:0,contentDownload:0,totalDuration:0,statusCode:0}}};chrome.runtime.sendMessage({action:"PERF_DATA",url:e,data:c,timestamp:Date.now(),runNumber:a,totalRuns:n,error:r||"Request failed"})}}function g(o,t){return{dnsLookup:o.domainLookupEnd-o.domainLookupStart,tcpConnection:o.connectEnd-o.connectStart,tlsHandshake:o.secureConnectionStart>0?o.connectEnd-o.secureConnectionStart:0,ttfb:o.responseStart-o.requestStart,contentDownload:o.responseEnd-o.responseStart,totalDuration:o.responseEnd-o.startTime,statusCode:t}}
